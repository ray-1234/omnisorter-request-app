# OmniSorter 見積・図面依頼システム

📦 立体型仕分けロボット「OmniSorter」の見積・図面依頼を効率化するStreamlitアプリケーション

## 📋 概要

このシステムは、立体型仕分けロボット「OmniSorter」の見積書作成および図面作成依頼を効率化するWebアプリケーションです。営業担当者や技術者が顧客向けの仕様を入力し、適切な依頼文を自動生成してNotion DBに保存できます。

### OmniSorterについて
- **製品**: 立体型仕分けロボット（HC ROBOTICS製）
- **処理能力**: 800-1,200pcs/時の高速仕分け
- **機種**: S、M、L、miniの4機種
- **構成**: インダクション、モニター、仕分けエリアの3要素

## ✨ 主な機能

### 🎯 コア機能
- **仕様入力フォーム**: OmniSorterの詳細仕様を体系的に入力
- **見積依頼文生成**: 入力仕様から日本語の見積依頼文を自動生成
- **図面依頼文生成**: 入力仕様から英語の図面依頼文を自動生成
- **Notion連携**: 依頼情報をNotionデータベースに自動保存

### 🔧 運用モード
1. **簡易モード**: 顧客名・案件名を直接入力
2. **マスタ連携モード**: 既存の顧客企業マスタ・案件管理DBと連携

### 📊 自動計算機能
- **間口数計算**: 段×列×2×ブロック数
- **面数計算**: ブロック数×2
- **追加カート数**: 面数に基づく推奨値
- **追加トート数**: 間口数に基づく推奨値

## 🏗️ システム構成

### 技術スタック
- **フロントエンド**: Streamlit
- **バックエンド**: Python 3.x
- **データベース**: Notion API
- **デプロイ**: Streamlit Cloud / Docker対応

### 必要な設定項目
```env
# 必須設定
NOTION_API_KEY=your_notion_api_key
NOTION_DATABASE_ID=your_database_id

# マスタ連携用（オプション）
CUSTOMER_DB_ID=customer_database_id
PROJECT_DB_ID=project_database_id
OMNISORTER_REQUEST_DB_ID=request_database_id
```

## 🚀 インストール・セットアップ

### 1. 必要なライブラリのインストール
```bash
pip install streamlit requests
```

### 2. Notion APIセットアップ
1. [Notion Developers](https://developers.notion.com/)でAPIキーを取得
2. 対象データベースにIntegrationを追加
3. 必要なプロパティを設定

### 3. アプリケーション起動
```bash
streamlit run app.py
```

## 📝 入力仕様項目

### OS機種
- S, M, L, mini から選択

### 本体構成
- **段数**: 2-5段
- **列数**: 3-5列
- **ブロック数**: 最大10ブロック
- **間口タイプ**: カート式、固定（棚）式、スロープ式
- **スロープ長さ**: mm単位での指定
- **引き出し有無**: スロープ式の場合のみ

### 設置容器
- **容器タイプ**: 標準トート、個別容器、無し
- **寸法**: 奥行・幅・高さ（mm単位）

### 仕分け商品
- **最大サイズ**: 奥行・幅・高さ（mm単位）

### オプション
- **DAS**: 有/無
- **満杯センサー**: 有/無
- **追加カート**: 面数に基づく選択肢
- **追加トート**: 間口数に基づく選択肢
- **滑り止めベルト**: 有/無
- **薄物対応**: 有/無

## 📊 Notionデータベース設計

### OmniSorter依頼DB（基本）
| プロパティ名 | タイプ | 説明 |
|------------|-------|------|
| 顧客名 | Title | 依頼元企業名 |
| 案件名 | Rich Text | プロジェクト名 |
| 依頼日 | Date | 依頼日時 |
| 依頼種別 | Select | 見積/図面、見積のみ、図面のみ |
| 依頼機種 | Select | S、M、L、mini |
| ステータス | Select | 依頼中、対応中、完了 |
| 見積依頼文 | Rich Text | 生成された見積依頼文 |
| 図面依頼文 | Rich Text | 生成された図面依頼文（英語） |
| 仕様詳細 | Rich Text | 入力された詳細仕様 |
| 備考 | Rich Text | 特記事項 |

### マスタ連携用追加DB
- **顧客企業マスタ**: 会社名、連絡先等
- **案件管理DB**: 案件名、顧客企業（リレーション）、ステータス等

## 🔧 システム診断機能

アプリケーション内蔵の診断機能で以下をチェック：
- Notion API接続状態
- データベースアクセス権限
- プロパティ設定状況
- マスタ連携設定

## 🎨 UI/UX特徴

### レスポンシブデザイン
- タブベースの直感的なUI
- カテゴリ別の仕様入力
- リアルタイムな自動計算表示

### 条件付き表示
- スロープ式選択時のみスロープ関連項目表示
- カート式選択時のみカート関連項目表示
- 標準トート選択時のみトート関連項目表示

### エラーハンドリング
- 入力値の妥当性チェック
- API接続エラーの適切な表示
- タイムアウト対応

## 🔄 運用フロー

1. **仕様入力**: 顧客要件に基づく詳細仕様の入力
2. **自動計算**: 間口数・面数等の自動算出
3. **依頼文生成**: 見積/図面依頼文の自動生成
4. **確認・修正**: 生成された依頼文の確認
5. **Notion保存**: データベースへの保存
6. **外部連携**: 生成された依頼文をコピーして外部システムで利用

## 📈 メリット

### 効率化
- 手作業での依頼書作成時間を大幅短縮
- 標準化されたフォーマットによる品質向上
- 入力ミスの削減

### 情報管理
- 全依頼履歴のデータベース化
- 進捗状況の一元管理
- 案件・顧客情報との連携

### 多言語対応
- 日本語での見積依頼文
- 英語での図面依頼文
- 国際的な技術連携に対応

## 🛠️ カスタマイズポイント

### 機種・仕様の追加
`FORM_ITEMS`配列を修正することで新しい仕様項目を追加可能

### 計算ロジックの変更
`calculate_grid_count`等の関数を修正して計算式を調整

### 依頼文テンプレート
`generate_quotation_text`、`generate_drawing_text`関数でフォーマット変更

## 📞 サポート

システムに関するお問い合わせ：
- 技術的な問題: システム管理者まで
- 仕様・要件: 営業部門まで

---

*このシステムは、OmniSorter販売支援のために開発されました。*
